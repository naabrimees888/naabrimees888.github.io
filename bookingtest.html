<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add to Google Calendar</title>
<script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h1>Add to Google Calendar</h1>
  <form id="eventForm">
    <label for="eventName">Event Name:</label><br>
    <input type="text" id="eventName" name="eventName" required><br>
    <label for="eventDate">Event Date:</label><br>
    <input type="date" id="eventDate" name="eventDate" required><br>
    <label for="eventTime">Event Time:</label><br>
    <input type="time" id="eventTime" name="eventTime" required><br><br>
    <button type="button" id="authorize_button">Authorize</button>
    <button type="button" id="addToCalendar">Add to Google Calendar</button>
  </form>

  <script>
    var CLIENT_ID = '1062970372713-ov7r58nb41bi2g1qmmm49gc655bmk9sm.apps.googleusercontent.com';
    var API_KEY = 'AIzaSyBdz8fT3UzafG34pkIIZBekHCiSEiWoqI4';
    var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
    var SCOPES = 'https://www.googleapis.com/auth/calendar.events';

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(function () {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        document.getElementById('authorize_button').onclick = handleAuthClick;
        document.getElementById('addToCalendar').onclick = addEventToCalendar;
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        document.getElementById('authorize_button').style.display = 'none';
        document.getElementById('addToCalendar').style.display = 'inline-block';
      } else {
        document.getElementById('authorize_button').style.display = 'inline-block';
        document.getElementById('addToCalendar').style.display = 'none';
      }
    }

    function handleAuthClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    function addEventToCalendar() {
      var eventData = document.getElementById('eventForm').elements;
      var eventName = eventData.namedItem('eventName').value;
      var eventDate = eventData.namedItem('eventDate').value;
      var eventTime = eventData.namedItem('eventTime').value;
      var startDate = new Date(eventDate + 'T' + eventTime + ':00');
      var endDate = new Date(startDate.getTime() + (60 * 60 * 1000)); // 1 hour duration

      var event = {
        'summary': eventName,
        'start': {
          'dateTime': startDate.toISOString(),
          'timeZone': 'YOUR_TIME_ZONE'
        },
        'end': {
          'dateTime': endDate.toISOString(),
          'timeZone': 'YOUR_TIME_ZONE'
        }
      };

      var request = gapi.client.calendar.events.insert({
        'calendarId': 'primary',
        'resource': event
      });

      request.execute(function(event) {
        console.log('Event created: ' + event.htmlLink);
        window.open(event.htmlLink);
      });
    }
  </script>
  <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
</body>
</html>
